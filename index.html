<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Download & Embed Snippet Generator</title>
    <style>
      :root {
        --bg-color: #121212;
        --surface-color: #1e1e1e;
        --primary-color: #bb86fc;
        --primary-variant: #3700b3;
        --secondary-color: #03dac6;
        --text-color: #e0e0e0;
        --border-color: #333333;
        --focus-ring-color: rgba(187, 134, 252, 0.4);
        --danger-color: #cf6679;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
      }

      .container {
        width: 100%;
        max-width: 900px;
        background-color: var(--surface-color);
        padding: 30px;
        border-radius: 16px;
        border: 1px solid var(--border-color);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
        color: var(--secondary-color);
        font-weight: 600;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9em;
        color: #bbbbbb;
      }

      .input,
      .select {
        width: 100%;
        padding: 12px;
        background-color: #2c2c2c;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-color);
        font-size: 1rem;
        transition: border-color 0.3s, box-shadow 0.3s;
      }

      .input:focus,
      .select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px var(--focus-ring-color);
      }

      .button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 18px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        color: #121212;
      }

      .button.primary {
        background-color: var(--primary-color);
      }
      .button.secondary {
        background-color: var(--secondary-color);
      }
      .button.danger {
        background-color: var(--danger-color);
        color: white;
      }

      #server-blocks {
        display: flex;
        flex-direction: column;
        gap: 25px;
        margin-top: 20px;
      }

      .server-block {
        background-color: #2a2a2a;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        transition: box-shadow 0.3s;
      }
      .server-block:focus-within {
        box-shadow: 0 0 0 2px var(--primary-color);
      }

      .server-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
      }

      .server-header h3 {
        color: var(--secondary-color);
      }

      .episode-block {
        background-color: #333333;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .episode-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .grid-2 {
        display: grid;
        gap: 15px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 600px) {
        .grid-2 {
          grid-template-columns: 100px 1fr;
        }
      }

      .download-links-container {
        margin-top: 20px;
      }
      .download-link-row {
        display: grid;
        grid-template-columns: 1fr 1fr 120px auto;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
      }

      .output-area {
        width: 100%;
        min-height: 200px;
        font-family: "Fira Code", "Courier New", monospace;
        font-size: 0.9em;
        white-space: pre-wrap;
        word-break: break-all;
        background-color: #161616;
        margin-top: 10px;
      }

      .main-actions {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .output-container {
        margin-top: 20px;
      }
      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
      }

      .toast {
        position: fixed;
        bottom: -100px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--secondary-color);
        color: var(--bg-color);
        padding: 14px 28px;
        border-radius: 8px;
        font-weight: bold;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        transition: bottom 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        z-index: 1000;
      }

      .toast.show {
        bottom: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Download & Embed Snippet Generator</h2>

      <div id="server-blocks">
        <!-- Server block will be added here by JavaScript -->
      </div>

      <div class="main-actions">
        <button
          type="button"
          id="generate-btn"
          class="button primary"
          style="width: 100%; max-width: 300px"
        >
          Generate Snippets
        </button>
      </div>

      <!-- HASIL KODE UNTUK EMBED -->
      <div class="output-container">
        <div class="output-header">
          <label for="output-li"
            >Hasil Kode Episode (<code>&lt;li&gt;</code>)</label
          >
          <button
            type="button"
            class="button secondary copy-btn"
            data-target="output-li"
          >
            Salin Kode
          </button>
        </div>
        <textarea id="output-li" class="input output-area" readonly></textarea>
      </div>

      <!-- HASIL KODE UNTUK DOWNLOAD -->
      <div class="output-container">
        <div class="output-header">
          <label for="output-downloads"
            >Hasil Kode Download (<code>&lt;div&gt;</code>)</label
          >
          <button
            type="button"
            class="button secondary copy-btn"
            data-target="output-downloads"
          >
            Salin Kode
          </button>
        </div>
        <textarea
          id="output-downloads"
          class="input output-area"
          readonly
        ></textarea>
      </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const generateBtn = document.getElementById("generate-btn");
        const serverBlocksContainer = document.getElementById("server-blocks");
        const container = document.querySelector(".container");

        function addServerBlock() {
          const serverBlock = document.createElement("div");
          serverBlock.className = "server-block";
          serverBlock.innerHTML = `
                    <div class="server-header">
                        <h3>Server</h3>
                    </div>
                    <div>
                        <label>Nama Server (untuk \`data-id\`)</label>
                        <input type="text" class="input server-name" value="Server">
                    </div>
                    <div class="episode-list" style="margin-top: 20px;">
                        <!-- Episode blocks will be added here -->
                    </div>
                    <button type="button" class="button secondary add-episode-btn" style="margin-top: 15px;">Tambah Episode</button>
                `;
          serverBlocksContainer.appendChild(serverBlock);
          addEpisodeRow(serverBlock.querySelector(".episode-list"));
        }

        function addEpisodeRow(container) {
          const episodeBlock = document.createElement("div");
          episodeBlock.className = "episode-block";
          episodeBlock.innerHTML = `
                    <div class="episode-header">
                        <h4>Episode</h4>
                        <button type="button" class="button danger remove-episode-btn" style="padding: 6px 10px; font-size: 0.8rem;">Hapus</button>
                    </div>
                    <div class="grid-2">
                        <div>
                            <label>Nomor</label>
                            <input type="text" class="input episode-number" placeholder="01">
                        </div>
                        <div>
                            <label>URL Embed</label>
                            <input type="url" class="input embed-url" placeholder="https://...">
                        </div>
                    </div>
                    <div class="download-links-container">
                        <h5 style="margin-top: 15px; margin-bottom: 10px;">Link Download Episode Ini</h5>
                        <!-- Download link rows will be added here -->
                    </div>
                    <button type="button" class="button secondary add-download-btn" style="padding: 8px 12px; font-size: 0.9rem;">Tambah Link Download</button>
                `;
          container.appendChild(episodeBlock);
          addDownloadLinkRow(
            episodeBlock.querySelector(".download-links-container")
          );
        }

        function addDownloadLinkRow(container) {
          const downloadRow = document.createElement("div");
          downloadRow.className = "download-link-row";
          downloadRow.innerHTML = `
                    <input type="text" class="input download-source" placeholder="Sumber" value="Server 1">
                    <input type="url" class="input download-url" placeholder="URL Download">
                    <select class="select download-quality">
                        <option selected>HD</option>
                        <option>1080p</option>
                        <option>720p</option>
                        <option>480p</option>
                        <option>360p</option>
                    </select>
                    <button type="button" class="button danger remove-download-btn" style="padding: 8px;">X</button>
                `;
          container.appendChild(downloadRow);
        }

        generateBtn.addEventListener("click", generateSnippets);

        container.addEventListener("click", (e) => {
          const target = e.target;
          if (target.classList.contains("add-episode-btn")) {
            addEpisodeRow(target.previousElementSibling);
          }
          if (target.classList.contains("remove-episode-btn")) {
            target.closest(".episode-block").remove();
          }
          if (target.classList.contains("add-download-btn")) {
            addDownloadLinkRow(target.previousElementSibling);
          }
          if (target.classList.contains("remove-download-btn")) {
            target.closest(".download-link-row").remove();
          }
          if (target.classList.contains("copy-btn")) {
            copyCode(target.dataset.target);
          }
        });

        // Automatically add the first server block on page load
        addServerBlock();
      });

      function generateSnippets() {
        const serverBlock = document.querySelector(".server-block");
        if (!serverBlock) {
          document.getElementById("output-li").value =
            "Tidak ada server untuk digenerate.";
          document.getElementById("output-downloads").value = "";
          return;
        }

        let allLiHtml = "";
        let allDownloadsHtml = "";

        const serverNamePrefix = serverBlock
          .querySelector(".server-name")
          .value.trim();
        const episodeBlocks = serverBlock.querySelectorAll(".episode-block");

        episodeBlocks.forEach((episodeBlock) => {
          const episodeNumber = episodeBlock
            .querySelector(".episode-number")
            .value.trim();
          const embedUrl = episodeBlock
            .querySelector(".embed-url")
            .value.trim();

          if (episodeNumber && embedUrl) {
            const dataId = `${serverNamePrefix}-${episodeNumber}`;
            allLiHtml += `<li>\n  <div class="DagPlayOpt" data-embed="${embedUrl}" data-id="${dataId}">\n    <span>${episodeNumber}</span>\n  </div>\n</li>\n`;
          }

          const downloadRows =
            episodeBlock.querySelectorAll(".download-link-row");
          const validDownloadLinks = [];
          downloadRows.forEach((row) => {
            const source = row.querySelector(".download-source").value.trim();
            const url = row.querySelector(".download-url").value.trim();
            const quality = row.querySelector(".download-quality").value;
            if (source && url) {
              validDownloadLinks.push({ source, url, quality });
            }
          });

          if (episodeNumber && validDownloadLinks.length > 0) {
            const dataId = `${serverNamePrefix}-${episodeNumber}`;
            let downloadRowsHtml = "";
            validDownloadLinks.forEach((link) => {
              downloadRowsHtml += `        <tr>\n`;
              downloadRowsHtml += `          <td><span class="num"></span> ${link.source}</td>\n`;
              downloadRowsHtml += `          <td>Sub</td>\n`;
              downloadRowsHtml += `          <td><span>${link.quality}</span></td>\n`;
              downloadRowsHtml += `          <td><a class="btn sm rnd" href="${link.url}" rel="nofollow" target="_blank">Download</a></td>\n`;
              downloadRowsHtml += `        </tr>\n`;
            });

            allDownloadsHtml += `<div class="resIn" id="${dataId}"> \n`;
            allDownloadsHtml += `  <div class="download-links">\n`;
            allDownloadsHtml += `    <table>\n`;
            allDownloadsHtml += `      <thead>\n        <tr>\n          <th>Server</th>\n          <th>Subtitle</th>\n          <th>Kualitas</th>\n          <th>Link</th>\n        </tr>\n      </thead>\n`;
            allDownloadsHtml += `      <tbody>\n${downloadRowsHtml}      </tbody>\n`;
            allDownloadsHtml += `    </table>\n  </div>\n</div>\n\n`;
          }
        });

        document.getElementById("output-li").value = allLiHtml.trimEnd();
        document.getElementById("output-downloads").value =
          allDownloadsHtml.trimEnd();
        showToast("Kode snippet berhasil digenerate!");
      }

      function copyCode(targetId) {
        const outputTextarea = document.getElementById(targetId);
        if (!outputTextarea.value) {
          showToast("Tidak ada kode untuk disalin.", true);
          return;
        }
        navigator.clipboard
          .writeText(outputTextarea.value)
          .then(() => {
            showToast("Kode berhasil disalin!");
          })
          .catch(() => {
            showToast("Gagal menyalin. Coba salin manual.", true);
          });
      }

      function showToast(message, isError = false) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.style.backgroundColor = isError
          ? "var(--danger-color)"
          : "var(--secondary-color)";
        toast.style.color = isError ? "#ffffff" : "#000000";
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
      }
    </script>
  </body>
</html>
